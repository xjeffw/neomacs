(fboundp 'query-replace)
(fboundp 'query-replace-regexp)
(with-temp-buffer
  (insert "Foo foo")
  (goto-char (point-min))
  (let ((unread-command-events (list ?!)))
    (query-replace "foo" "bar"))
  (buffer-string))
(with-temp-buffer
  (insert "a1 b2")
  (goto-char (point-min))
  (let ((unread-command-events (list ?!)))
    (query-replace-regexp "[0-9]+" "X"))
  (buffer-string))
(with-temp-buffer
  (insert "aa bb aa")
  (let ((start 4) (end 8))
    (goto-char (point-min))
    (let ((unread-command-events (list ?!)))
      (query-replace "aa" "zz" nil start end))
    (buffer-string)))
(with-temp-buffer
  (insert "abc")
  (goto-char (point-min))
  (let ((unread-command-events (list ?!)))
    (query-replace "" "x"))
  (buffer-string))
(condition-case err (query-replace "a") (wrong-number-of-arguments (car err)))
(condition-case err (query-replace 1 "x") (error err))
(condition-case err (query-replace-regexp "a") (wrong-number-of-arguments (car err)))
(condition-case err (query-replace-regexp 1 "x") (error err))
