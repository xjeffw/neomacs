(subr-arity (symbol-function 'featurep))

(condition-case err (featurep 'vm-featurep-sentinel) (error err))
(condition-case err (featurep 'vm-featurep-sentinel nil) (error err))
(condition-case err (featurep 'vm-featurep-sentinel 'subfeature) (error err))
(condition-case err (featurep 'vm-featurep-sentinel 1) (error err))

(condition-case err (featurep 1) (error err))
(condition-case err (featurep 'vm-featurep-sentinel nil nil) (error err))

(let ((old-features features))
  (unwind-protect
      (progn
        (setq features '(vm-featurep-present))
        (put 'vm-featurep-present 'subfeatures '(subfeature 1))
        (list (featurep 'vm-featurep-present)
              (featurep 'vm-featurep-present nil)
              (featurep 'vm-featurep-present 'subfeature)
              (featurep 'vm-featurep-present 1)
              (featurep 'vm-featurep-present 'missing)))
    (setq features old-features)
    (put 'vm-featurep-present 'subfeatures nil)))

(let ((old-features features))
  (unwind-protect
      (progn
        (setq features '(vm-featurep-present))
        (put 'vm-featurep-present 'subfeatures 1)
        (condition-case err (featurep 'vm-featurep-present 'subfeature) (error err)))
    (setq features old-features)
    (put 'vm-featurep-present 'subfeatures nil)))
