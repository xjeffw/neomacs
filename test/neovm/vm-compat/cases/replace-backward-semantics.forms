(fboundp 'replace-string)
(fboundp 'replace-regexp)
(fboundp 'query-replace)
(fboundp 'query-replace-regexp)

(with-temp-buffer
  (insert "foo x foo y foo")
  (goto-char (point-max))
  (replace-string "foo" "bar" nil nil nil t)
  (list (buffer-string) (point)))

(with-temp-buffer
  (insert "foo x foo y foo")
  (goto-char (point-min))
  (replace-string "foo" "bar" nil nil nil t)
  (list (buffer-string) (point)))

(with-temp-buffer
  (insert "foo x foo y foo")
  (goto-char (point-max))
  (replace-regexp "foo" "bar" nil nil nil t)
  (list (buffer-string) (point)))

(with-temp-buffer
  (insert "foo x foo y foo")
  (goto-char (point-max))
  (let ((unread-command-events (list ?!)))
    (query-replace "foo" "bar" nil nil nil t))
  (list (buffer-string) (point)))

(with-temp-buffer
  (insert "foo x foo y foo")
  (goto-char (point-max))
  (let ((unread-command-events (list ?!)))
    (query-replace-regexp "foo" "bar" nil nil nil t))
  (list (buffer-string) (point)))
