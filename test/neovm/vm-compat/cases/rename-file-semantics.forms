; rename-file argument validation and overwrite semantics.

(condition-case err
    (rename-file 1 "/tmp/x")
  (error err))

(condition-case err
    (rename-file "/tmp/x" 1)
  (error err))

(condition-case err
    (rename-file "/tmp/x")
  (error err))

(let* ((base (make-temp-file "neovm-rename-file-" t))
       (src (expand-file-name "src.txt" base))
       (dst (expand-file-name "dst.txt" base)))
  (with-temp-buffer (insert "x") (write-region nil nil src))
  (with-temp-buffer (insert "y") (write-region nil nil dst))
  (prog1
      (list (condition-case err
                (rename-file src dst)
              (error (car err)))
            (condition-case err
                (rename-file src dst t)
              (error (car err)))
            (file-exists-p src)
            (file-exists-p dst))
    (delete-file dst)
    (delete-directory base)))

(condition-case err
    (rename-file "a" "b" nil nil)
  (error err))

(let* ((base (make-temp-file "neovm-rename-file-eval-" t))
       (src (expand-file-name "src.txt" base)))
  (with-temp-buffer (insert "x") (write-region nil nil src))
  (prog1
      (let ((default-directory (file-name-as-directory base)))
        (list (rename-file "src.txt" "dst.txt")
              (file-exists-p "src.txt")
              (file-exists-p "dst.txt")))
    (delete-file (expand-file-name "dst.txt" base))
    (delete-directory base)))
